<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monitor de TensÃ£o</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

  <div class="container py-4">
    <h2 class="mb-3">Monitor de TensÃ£o</h2>

    <div class="card shadow-sm">
      <div class="card-body">
        <canvas id="tensaoChart" style="height:300px;"></canvas>
      </div>
    </div>

    <div class="mt-3">
      <span class="text-muted">Ãšltima leitura: </span>
      <strong id="currentValue">Carregando...</strong>
    </div>

    <div class="mt-3">
      <a href="#" class="btn btn-primary btn-sm" onclick="location.reload()">ðŸ”„ Atualizar agora</a>
      <a href="/tabela.html" class="btn btn-secondary btn-sm">ðŸ“‹ Ver tabela</a>
    </div>
  </div>

<script>
  const ctx = document.getElementById('tensaoChart').getContext('2d');
  const tensaoChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'TensÃ£o (V)',
        borderColor: '#0d6efd',
        backgroundColor: 'rgba(13,110,253,0.2)',
        fill: true,
        data: [],
        tension: 0.3,
        pointRadius: 3,
      }]
    },
    options: { responsive: true, maintainAspectRatio: false }
  });

  async function updateChart() {
    try {
      const res = await fetch('https://projeto-tensao-rasp.vercel.app/api/tensao');
      const data = await res.json();
      const reversedData = data.reverse().slice(-20); // Ãºltimos 20 pontos

      tensaoChart.data.labels = reversedData.map(d => new Date(d.timestamp).toLocaleTimeString());
      tensaoChart.data.datasets[0].data = reversedData.map(d => d.tensao);
      tensaoChart.update();

      document.getElementById('currentValue').textContent = 
        reversedData[reversedData.length - 1].tensao.toFixed(2) + ' V';

    } catch (err) {
      console.error('Erro ao atualizar grÃ¡fico:', err);
      document.getElementById('currentValue').textContent = 'Erro ao carregar dados';
    }
  }

  updateChart();
  setInterval(updateChart, 3000);
</script>

</body>
</html>
