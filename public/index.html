<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Monitor de TensÃ£o</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-light">

  <div class="container py-4">
    <h2 class="mb-3">Monitor de TensÃ£o</h2>

    <div class="card shadow-sm">
      <div class="card-body">
        <canvas id="tensaoChart" style="height:400px;"></canvas>
      </div>
    </div>

    <div class="mt-3">
      <a href="#" class="btn btn-primary btn-sm" onclick="location.reload()">ğŸ”„ Atualizar agora</a>
      <a href="/tabela.html" class="btn btn-secondary btn-sm">ğŸ“‹ Ver tabela</a>
    </div>
  </div>

<script>
  const ctx = document.getElementById('tensaoChart').getContext('2d');
  const tensaoChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'TensÃ£o (V)',
        borderColor: '#0d6efd',
        backgroundColor: 'rgba(13,110,253,0.2)',
        fill: true,
        data: [],
        tension: 0.3,
        pointRadius: 2,
      }]
    },
    options: { 
      responsive: true, 
      maintainAspectRatio: false,
      scales: {
        y: { beginAtZero: false }
      }
    }
  });

  async function updateChart() {
    try {
      const res = await fetch('https://projeto-tensao-rasp.vercel.app/api/tensao');
      const data = await res.json();
      const reversedData = data.reverse().slice(-50); // Ãºltimos 50 pontos (~4min histÃ³rico)

      tensaoChart.data.labels = reversedData.map(d => new Date(d.timestamp).toLocaleTimeString());
      tensaoChart.data.datasets[0].data = reversedData.map(d => d.tensao);
      tensaoChart.update();

    } catch (err) {
      console.error('Erro ao atualizar grÃ¡fico:', err);
    }
  }

  updateChart();
  setInterval(updateChart, 5000); // atualiza a cada 5 segundos
</script>

</body>
</html>
