<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Tabela de Leituras</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2>Tabela de Leituras</h2>

  <div class="row g-2 my-3">
    <div class="col-md-3"><input type="date" id="dataInicio" class="form-control"></div>
    <div class="col-md-3"><input type="date" id="dataFim" class="form-control"></div>
    <div class="col-md-3"><input type="number" step="0.01" id="valorMin" placeholder="Valor mínimo" class="form-control"></div>
    <div class="col-md-3"><input type="number" step="0.01" id="valorMax" placeholder="Valor máximo" class="form-control"></div>
  </div>

  <button class="btn btn-primary btn-sm mb-3" onclick="carregarDados()">🔍 Aplicar filtro</button>
  <a href="/" class="btn btn-secondary btn-sm mb-3">🏠 Voltar ao gráfico</a>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Tensão (V)</th>
      </tr>
    </thead>
    <tbody id="tabelaLeituras">
    </tbody>
  </table>
</div>

<script>
async function carregarDados() {
  const res = await fetch('https://projeto-tensao-rasp.vercel.app/api/tensao');
  const dados = await res.json();

  const inicio = new Date(document.getElementById('dataInicio').value);
  const fim = new Date(document.getElementById('dataFim').value);
  const min = parseFloat(document.getElementById('valorMin').value);
  const max = parseFloat(document.getElementById('valorMax').value);

  const filtrado = dados.filter(d => {
    const data = new Date(d.timestamp);
    return (!isNaN(inicio) ? data >= inicio : true)
      && (!isNaN(fim) ? data <= fim : true)
      && (!isNaN(min) ? d.tensao >= min : true)
      && (!isNaN(max) ? d.tensao <= max : true);
  });

  const tbody = document.getElementById('tabelaLeituras');
  tbody.innerHTML = filtrado.map(d => `
    <tr>
      <td>${new Date(d.timestamp).toLocaleString()}</td>
      <td>${d.tensao.toFixed(2)} V</td>
    </tr>
  `).join('');
}

// Carrega todos os dados ao iniciar
carregarDados();
</script>

</body>
</html>
